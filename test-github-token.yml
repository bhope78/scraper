name: Test Cloudflare Token
on: 
  workflow_dispatch:

jobs:
  test-token:
    runs-on: ubuntu-latest
    steps:
      - name: Test Token Exists
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
        run: |
          echo "üîç Testing Cloudflare API Token from GitHub Secrets"
          echo "=================================================="
          
          if [ -z "$CLOUDFLARE_API_TOKEN" ]; then
            echo "‚ùå Token not found in GitHub Secrets!"
            exit 1
          fi
          
          echo "‚úÖ Token found in GitHub Secrets"
          echo "   Length: ${#CLOUDFLARE_API_TOKEN} characters"
          echo "   Starts with underscore: $([ "${CLOUDFLARE_API_TOKEN:0:1}" = "_" ] && echo "YES ‚úÖ" || echo "NO ‚ùå")"
          
          # Test with Cloudflare API
          echo ""
          echo "Testing token validity..."
          response=$(curl -s -X GET "https://api.cloudflare.com/client/v4/user/tokens/verify" \
               -H "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \
               -H "Content-Type: application/json")
          
          success=$(echo $response | jq -r '.success')
          if [ "$success" = "true" ]; then
            echo "‚úÖ Token is VALID and working!"
            echo $response | jq '.'
          else
            echo "‚ùå Token is INVALID or expired!"
            echo $response | jq '.'
            exit 1
          fi